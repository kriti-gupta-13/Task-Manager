<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>
<body>
    <div class="container">
        <h1 class="d-flex flex-row justify-content-around my-5">Welcome {{name}}</h1>
        <div class="d-flex flex-row justify-content-around row">
            <div class="col-5 border border-dark rounded px-4 py-3">
                <h2 class="d-flex flex-row justify-content-around">Create Tasks</h2>
                <form id="taskform">
                    <div>
                        <label for="description">Description:</label><br>
                        <input type="text" id="description" name="description" required><br>
                    </div>
                    <div>
                        <label for="dueDate">Due Date and Time:</label><br>
                        <input type="datetime-local" id="dueDate" name="dueDate" required><br>
                    </div>
                    <div>
                        <button class="btn btn-primary" type="submit" id="submit">Submit</button>
                    </div>
                </form>
            </div>
            <div class="col-2"></div>
            <div class="col-5 border border-dark rounded px-4 py-3">
                <h2 class="d-flex flex-row justify-content-around">Todo list</h2>
                <div class="mt-3">
                    {{#each tasks}}
                        <div class="border border-dark rounded mb-3 px-2 py-1 mx-3">
                            <div class="row">
                                <div class="col-6">
                                    <p class="m-0">{{description}}</p>
                                </div>
                                <div class="col-6">
                                    <p class="m-0">{{due}}</p>
                                </div>
                            </div>
                            <div class="row d-flex flex-row justify-content-around py-2">
                                <button data-id="{{_id}}" class="col-3 btn btn-outline-success btn-sm done--button">Done</button>
                                <button data-id="{{_id}}" class="col-3 btn btn-outline-secondary btn-sm update--button">Update</button>
                                <button data-id="{{_id}}" class="col-3 btn btn-outline-danger btn-sm delete--button">Delete</button>
                            </div>
                        </div>
                    {{/each}}
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('submit').addEventListener('click', function (event) {
            event.preventDefault();
            var description = document.getElementById('description').value;
            var dueDate = document.getElementById('dueDate').value;
            var data = {
                description,
                dueDate
            };
            console.log(data);
            fetch('http://localhost:3000/tasks', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(res => {
                console.log(res);
                if (res.task._id) {
                    // reload page
                    window.location.href = 'http://localhost:3000/';
                }
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        });
    
        var doneElements = document.getElementsByClassName('done--button');
        var updateElements = document.getElementsByClassName('update--button');
        var deleteElements = document.getElementsByClassName('delete--button');

        for (var i = 0; i < doneElements.length; i++) {
            doneElements[i].addEventListener('click', function (event) {
                event.preventDefault();
                var id = this.getAttribute('data-id');
                console.log(id);
                fetch('http://localhost:3000/tasks/mark-as-done/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({id})
                })
                .then(response => response.json())
                .then(res => {
                    console.log(res);
                    if (res.task._id) {
                        // reload page
                        window.location.href = 'http://localhost:3000/';
                    }
                })
                .catch((error) => {
                    alert('Error:', error);
                });
            });
        }

    </script>
</body>
</html>